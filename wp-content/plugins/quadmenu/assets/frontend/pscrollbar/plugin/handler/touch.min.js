
"use strict";var _=require("../../lib/helper");var instances=require("../instances");var updateGeometry=require("../update-geometry");var updateScroll=require("../update-scroll");function bindTouchHandler(b,o,f,s){function g(u,i){var x=b.scrollTop;var y=b.scrollLeft;var w=Math.abs(u);var v=Math.abs(i);if(v>w){if(((i<0)&&(x===o.contentHeight-o.containerHeight))||((i>0)&&(x===0))){return !o.settings.swipePropagation}}else{if(w>v){if(((u<0)&&(y===o.contentWidth-o.containerWidth))||((u>0)&&(y===0))){return !o.settings.swipePropagation}}}return true}function t(u,i){updateScroll(b,"top",b.scrollTop-i);updateScroll(b,"left",b.scrollLeft-u);updateGeometry(b)}var n={};var k=0;var p={};var q=null;var j=false;var c=false;function h(){j=true}function d(){j=false}function m(i){if(i.targetTouches){return i.targetTouches[0]}else{return i}}function l(i){if(i.targetTouches&&i.targetTouches.length===1){return true}if(i.pointerType&&i.pointerType!=="mouse"&&i.pointerType!==i.MSPOINTER_TYPE_MOUSE){return true}return false}function a(i){if(l(i)){c=true;var u=m(i);n.pageX=u.pageX;n.pageY=u.pageY;k=(new Date()).getTime();if(q!==null){clearInterval(q)}i.stopPropagation()}}function r(x){if(!c&&o.settings.swipePropagation){a(x)}if(!j&&c&&l(x)){var z=m(x);var w={pageX:z.pageX,pageY:z.pageY};var u=w.pageX-n.pageX;var i=w.pageY-n.pageY;t(u,i);n=w;var v=(new Date()).getTime();var y=v-k;if(y>0){p.x=u/y;p.y=i/y;k=v}if(g(u,i)){x.stopPropagation();x.preventDefault()}}}function e(){if(!j&&c){c=false;clearInterval(q);q=setInterval(function(){if(!instances.get(b)){clearInterval(q);return}if(!p.x&&!p.y){clearInterval(q);return}if(Math.abs(p.x)<0.01&&Math.abs(p.y)<0.01){clearInterval(q);return}t(p.x*30,p.y*30);p.x*=0.8;p.y*=0.8},10)}}if(f){o.event.bind(window,"touchstart",h);o.event.bind(window,"touchend",d);o.event.bind(b,"touchstart",a);o.event.bind(b,"touchmove",r);o.event.bind(b,"touchend",e)}if(s){if(window.PointerEvent){o.event.bind(window,"pointerdown",h);o.event.bind(window,"pointerup",d);o.event.bind(b,"pointerdown",a);o.event.bind(b,"pointermove",r);o.event.bind(b,"pointerup",e)}else{if(window.MSPointerEvent){o.event.bind(window,"MSPointerDown",h);o.event.bind(window,"MSPointerUp",d);o.event.bind(b,"MSPointerDown",a);o.event.bind(b,"MSPointerMove",r);o.event.bind(b,"MSPointerUp",e)}}}}module.exports=function(b){if(!_.env.supportsTouch&&!_.env.supportsIePointer){return}var a=instances.get(b);bindTouchHandler(b,a,_.env.supportsTouch,_.env.supportsIePointer)};