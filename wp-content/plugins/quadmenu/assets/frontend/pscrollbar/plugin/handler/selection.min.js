
"use strict";var _=require("../../lib/helper");var instances=require("../instances");var updateGeometry=require("../update-geometry");var updateScroll=require("../update-scroll");function bindSelectionHandler(e,d){function f(){var i=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";if(i.toString().length===0){return null}else{return i.getRangeAt(0).commonAncestorContainer}}var h=null;var g={top:0,left:0};function a(){if(!h){h=setInterval(function(){if(!instances.get(e)){clearInterval(h);return}updateScroll(e,"top",e.scrollTop+g.top);updateScroll(e,"left",e.scrollLeft+g.left);updateGeometry(e)},50)}}function c(){if(h){clearInterval(h);h=null}_.stopScrolling(e)}var b=false;d.event.bind(d.ownerDocument,"selectionchange",function(){if(e.contains(f())){b=true}else{b=false;c()}});d.event.bind(window,"mouseup",function(){if(b){b=false;c()}});d.event.bind(window,"mousemove",function(i){if(b){var k={x:i.pageX,y:i.pageY};var j={left:e.offsetLeft,right:e.offsetLeft+e.offsetWidth,top:e.offsetTop,bottom:e.offsetTop+e.offsetHeight};if(k.x<j.left+3){g.left=-5;_.startScrolling(e,"x")}else{if(k.x>j.right-3){g.left=5;_.startScrolling(e,"x")}else{g.left=0}}if(k.y<j.top+3){if(j.top+3-k.y<5){g.top=-5}else{g.top=-20}_.startScrolling(e,"y")}else{if(k.y>j.bottom-3){if(k.y-j.bottom+3<5){g.top=5}else{g.top=20}_.startScrolling(e,"y")}else{g.top=0}}if(g.top===0&&g.left===0){c()}else{a()}}})}module.exports=function(b){var a=instances.get(b);bindSelectionHandler(b,a)};