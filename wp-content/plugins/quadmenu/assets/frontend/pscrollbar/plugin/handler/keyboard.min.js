
"use strict";var _=require("../../lib/helper");var dom=require("../../lib/dom");var instances=require("../instances");var updateGeometry=require("../update-geometry");var updateScroll=require("../update-scroll");function bindKeyboardHandler(d,c){var b=false;c.event.bind(d,"mouseenter",function(){b=true});c.event.bind(d,"mouseleave",function(){b=false});var a=false;function e(g,f){var h=d.scrollTop;if(g===0){if(!c.scrollbarYActive){return false}if((h===0&&f>0)||(h>=c.contentHeight-c.containerHeight&&f<0)){return !c.settings.wheelPropagation}}var i=d.scrollLeft;if(f===0){if(!c.scrollbarXActive){return false}if((i===0&&g<0)||(i>=c.contentWidth-c.containerWidth&&g>0)){return !c.settings.wheelPropagation}}return true}c.event.bind(c.ownerDocument,"keydown",function(j){if((j.isDefaultPrevented&&j.isDefaultPrevented())||j.defaultPrevented){return}var i=dom.matches(c.scrollbarX,":focus")||dom.matches(c.scrollbarY,":focus");if(!b&&!i){return}var h=document.activeElement?document.activeElement:c.ownerDocument.activeElement;if(h){if(h.tagName==="IFRAME"){h=h.contentDocument.activeElement}else{while(h.shadowRoot){h=h.shadowRoot.activeElement}}if(_.isEditable(h)){return}}var g=0;var f=0;switch(j.which){case 37:g=-30;break;case 38:f=30;break;case 39:g=30;break;case 40:f=-30;break;case 33:f=90;break;case 32:if(j.shiftKey){f=90}else{f=-90}break;case 34:f=-90;break;case 35:if(j.ctrlKey){f=-c.contentHeight}else{f=-c.containerHeight}break;case 36:if(j.ctrlKey){f=d.scrollTop}else{f=c.containerHeight}break;default:return}updateScroll(d,"top",d.scrollTop-f);updateScroll(d,"left",d.scrollLeft+g);updateGeometry(d);a=e(g,f);if(a){j.preventDefault()}})}module.exports=function(b){var a=instances.get(b);bindKeyboardHandler(b,a)};