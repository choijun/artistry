
(function(i){var b={},o;i.fn.serializeArrayAll=function(){var q=/\r?\n/g;return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).map(function(r,s){var t=jQuery(this).val();if(t==null){return t==null}else{if(this.type=="checkbox"&&this.checked==false){return{name:this.name,value:this.checked?this.value:""}}else{return jQuery.isArray(t)?jQuery.map(t,function(v,u){return{name:s.name,value:v.replace(q,"\r\n")}}):{name:s.name,value:t.replace(q,"\r\n")}}}}).get()};i.fn.extend({quadmenuItemData:function(t,u){t=t||"menu-item";var r={},s,q=["menu-item-db-id","menu-item-object-id","menu-item-object","menu-item-parent-id","menu-item-position","menu-item-type","menu-item-title","menu-item-url","menu-item-description","menu-item-attr-title","menu-item-target","menu-item-classes","menu-item-xfn","menu-item-quadmenu","menu-item-quadmenu-widget",];if(!u&&t=="menu-item"){u=this.find(".menu-item-data-db-id").val()}if(!u){return r}this.find("input").each(function(){var v;s=q.length;while(s--){if(t=="menu-item"){v=q[s]+"["+u+"]"}else{if(t=="add-menu-item"){v="menu-item["+u+"]["+q[s]+"]"}}if(this.name&&v==this.name){r[q[s]]=this.value}}});return r}});var h=function(q){q.on("click",function(u){u.preventDefault();var r={},s=q.parent().find(".spinner"),t=q.parent();r[-1]={"menu-item-status":"publish","menu-item-title":q.data("menu_item_title"),"menu-item-url":q.data("menu_item_url"),"menu-item-type":q.data("menu_item_type"),"menu-item-quadmenu":q.data("menu_item_quadmenu"),"menu-item-parent-id":q.data("menu_item_parent_id"),};k(s,t,r)})};var m=function(q){q.on("click",".edit:first",function(r){r.preventDefault();r.stopPropagation();q.toggleClass("open");i(".quadmenu-column-item").not(q).removeClass("open")});q.on("click",".remove:first",function(s){var r=i("form",q);i.ajax({type:"post",url:ajaxurl,data:i.param(r.serializeArrayAll())+"&"+i.param({menu_id:i("#menu").val(),menu_item_id:r.data("menu_item_id"),action:"quadmenu_remove_nav_menu_item",nonce:quadmenu.nonce}),beforeSend:function(){q.addClass("saving")},complete:function(){q.removeClass("saving").fadeOut().remove()},success:function(t){console.log(t.data);q.trigger("remove.quadmenu.item",[q])},})});return q};var a=function(q){q.on("change",".menu-item-icon",function(s){var u=i(this).closest("form").data("menu_item_id"),r=i(this).val(),t=i("#quadmenu-title-"+u,q);setTimeout(function(){t.find("i").removeClass().addClass(r)},200)});q.on("keyup",".menu-item-title",function(r){var u=i(this).closest("form").data("menu_item_id"),s=i(this).val(),t=i("#quadmenu-title-"+u,q);setTimeout(function(){t.find("span").text(s)},200)})};var n=function(q){q.on("show.quadmenu.tab","li",function(u){var s=i(this),r=i(i(u.target).attr("href")),t=r.find(".spinner").first();if(r.data("loading")||r.data("loaded")||!s.data("menu_item_panel")){return}i.ajax({type:"post",url:ajaxurl,data:i.param({menu_id:i("#menu").val(),menu_item_id:s.data("menu_item_id"),menu_item_panel:s.data("menu_item_panel"),action:"quadmenu_add_nav_menu_item_panel",nonce:quadmenu.nonce}),beforeSend:function(){r.data("loading",true);t.addClass("is-active")},complete:function(){r.removeData("loading");t.removeClass("is-active")},success:function(w){if(w.success!==true){alert(w.data);return}var v=i(w.data);r.data("loaded",true);r.append(v);p(r);e(r);c(r);a(r);d(r);g(r);f(r)},})})};var d=function(q){q.on("click",".menu-item-media-upload",function(w){w.preventDefault();var t=null;var v=i(this).closest(".field-wrapper"),s=i(this).closest("form"),u=i(this).siblings(".edit-menu-item-media-thumbnail"),r=i(this).siblings(".edit-menu-item-media-thumbnail-id");t=wp.media({button:{text:quadmenu.add_background},library:{type:"image"},multiple:false});t.on("open",function(){var y=t.state().get("selection");var x=r.val();if(x){y.add(wp.media.attachment(x))}});t.on("select",function(){var y=t.state().get("selection").first().toJSON(),x=typeof y.sizes.thumbnail!=="undefined"?y.sizes.full.url:y.url,z=typeof y.sizes.thumbnail!=="undefined"?y.sizes.thumbnail.url:y.url;v.addClass("active");u.html('<img src="'+z+'" width="50" height="50" >');r.val(y.id).data("src",x).trigger("change");s.trigger("change")});t.open()});q.on("click",".menu-item-media-clear",function(v){v.preventDefault();var u=i(this).closest(".field-wrapper"),s=i(this).siblings(".edit-menu-item-media-css"),t=i(this).siblings(".edit-menu-item-media-thumbnail"),r=i(this).siblings(".edit-menu-item-media-thumbnail-id");u.removeClass("active");t.html("");r.val("").removeData("src").trigger("change");s.html("");return false})};var g=function(r){var q=i(".quadmenu-setting-background .field-background",r);r.on("change",".edit-menu-item-background-position",function(s){s.preventDefault();q.css("background-position",i(this).val())});r.on("change",".edit-menu-item-background-size",function(s){s.preventDefault();q.css("background-size",i(this).val())});r.on("change",".edit-menu-item-background-repeat",function(s){s.preventDefault();q.css("background-repeat",i(this).val())});r.on("change",".edit-menu-item-media-thumbnail-id",function(s){s.preventDefault();if(!i(this).data("src")){return}q.css("background-image","url("+i(this).data("src")+")")})};var c=function(q){i(".quadmenu-setting-icon, .quadmenu-setting-login, .quadmenu-setting-logout",q).each(function(){var s=i(this),u=s.find(".button-icon"),v=i(".menu-item-icon, .menu-item-login, .menu-item-logout",s),r=s.find(".quadmenu-icons-scroll .icon"),t=s.find('input[type="search"]');t.on("keyup",function(w){w.preventDefault();setTimeout(function(){var x=t.val();if(x!==""){r.css({display:"none"});r.filter('[class*="'+x+'"]').css({display:"block"})}else{r.removeAttr("style")}},600)});r.on("click",function(x){x.preventDefault();i(this).addClass("selected").siblings().removeClass("selected");var w=i(this).find("i").attr("class");v.add(t).val(w).trigger("change");u.find("i").removeClass().addClass(w)});u.add(t).on("click",function(w){t.val("").trigger("keyup")})})};var j=function(q){q.on("change",".quadmenu-setting-width",function(s){s.preventDefault();var r=i(this);setTimeout(function(){var t=r.find("option:selected");var v=i.map(t,function(w){if(w.value){return w.value}});var u=/(\s)*(col-.*?)(?=\s)/g;q[0].className=q[0].className.replace(u,"");q.addClass(v.join(" "))},400)});q.on("click",".contract:first",function(s){var r=q.find("select#menu-item-columns-width-sm > option:selected");if(r.prev().length){r.prev().prop("selected",true).trigger("change")}});q.on("click",".expand:first",function(s){var r=q.find("select#menu-item-columns-width-sm > option:selected");if(r.next().length){r.next().prop("selected",true).trigger("change")}});q.on("click",".add-quadmenu-column-item",function(s){var r=i(this);r.addClass("selected");i(".quadmenu-column-item").not(i(".quadmenu-column-item",i(this))).removeClass("open");i(".add-quadmenu-column-item").not(this).removeClass("selected");i("#menu-settings-column li").each(function(){var u=i(this).find(".submit-add-to-quadmenu-column-inside"),t=i(this).find(".submit-add-to-menu, .submit-add-to-quadmenu");i("#quadmenu_custom_nav_widgets").addClass("active");if(!u.length){var u=t.clone();u.val(quadmenu.button);u.removeClass("submit-add-to-menu submit-add-to-quadmenu button-secondary").addClass("submit-add-to-quadmenu-column-inside button-primary");t.before(u)}u.data("menu_item_parent_id",r.data("menu_item_parent_id"))});i("#menu-settings-column li").addClass("current-column").find("li input:checked").prop("checked",false)});return q};var l=function(q){i("form",q).off("change.quadmenu.settings");q.on("submit","form",function(s){s.preventDefault();s.stopPropagation();var r=i(this);i.ajax({type:"post",url:ajaxurl,data:i.param(r.serializeArrayAll())+"&"+i.param({menu_item_id:r.data("menu_item_id"),action:"quadmenu_save_widget",nonce:quadmenu.nonce}),beforeSend:function(){q.addClass("saving")},complete:function(){q.removeClass("saving")},success:function(t){wpNavMenu.menusChanged=false;console.log(t.data)},})});q.on("click",".edit:first",function(s){var t=q.find(".widget"),r=q.find("form");if(t.hasClass("open")||t.data("loaded")){return}i.ajax({type:"post",url:ajaxurl,data:i.param({widget:q.data("widget"),widget_id:q.data("widget_id"),menu_item_id:r.data("menu_item_id"),action:"quadmenu_form_widget",nonce:quadmenu.nonce}),beforeSend:function(){q.addClass("saving")},complete:function(){q.removeClass("saving")},success:function(v){if(v.success!==true){alert(v.data);return}var u=i(v.data);r.html(u);t.toggleClass("open").data("loaded",true);setTimeout(function(){i(document).trigger("widget-added",[t])},200)},})})};var f=function(q){i(".sortable-area",q).each(function(){var r=i(this);r.sortable({forcePlaceholderSize:true,items:r.data("sortable-items")||false,handle:r.data("sortable-handle")||false,connectWith:r.data("sortable-connect")||false,placeholder:"drop-area",over:function(s,t){i(this).closest(".quadmenu-column").addClass("hover")},out:function(s,t){i(this).closest(".quadmenu-column").removeClass("hover")},update:function(u,v){if(this===v.item.parent()[0]){if(v.sender==null){var w=i(this),s=i(v.item);i(r.data("sortable-items"),w).each(function(t,x){b[i(this).data("menu_item_id")]={"menu-item-position":t,"menu-item-parent-id":w.data("menu_item_parent_id")}});i.ajax({type:"post",url:ajaxurl,data:{action:"quadmenu_update_nav_menu_item",nonce:quadmenu.nonce,menu_id:i("#menu").val(),"menu-item":b},beforeSend:function(){s.addClass("saving")},complete:function(){s.removeClass("saving")},success:function(t){console.log(t.data)}})}}},receive:function(u,v){var w=i(this),s=i(v.item);w.find("> li").each(function(t,x){b[i(this).data("menu_item_id")]={"menu-item-position":t,"menu-item-parent-id":w.data("menu_item_parent_id")}});i.ajax({type:"post",url:ajaxurl,data:{action:"quadmenu_update_nav_menu_item",nonce:quadmenu.nonce,menu_id:i("#menu").val(),"menu-item":b},beforeSend:function(){s.addClass("saving")},success:function(t){s.removeClass("saving")}})},start:function(s,t){t.item.data("start_pos",t.item.index())},stop:function(t,u){u.item.removeAttr("style");var s=u.item.data("start_pos");if(s!==u.item.index()){}}})})};var e=function(q){var s=i("#quadmenu-settings"),r=i("form",q);r.on("change.quadmenu.settings",function(u){u.preventDefault();var t=i(this);i.ajax({type:"post",url:ajaxurl,data:i.param(t.serializeArrayAll())+"&"+i.param({menu_id:i("#menu").val(),menu_item_id:t.data("menu_item_id"),action:"quadmenu_save_nav_menu_item_settings",nonce:quadmenu.nonce}),beforeSend:function(){s.addClass("saving")},complete:function(){s.removeClass("saving")},success:function(v){console.log(v.data);wpNavMenu.menusChanged=false;t.trigger("save.quadmenu.settings",[t.data("menu_item_id"),t.serializeArrayAll()])}})})};var p=function(s){var q=i(".quadmenu-tabs",s),r=i(".quadmenu-columns",s);i(".quadmenu-tab, .quadmenu-panel",q).each(function(t,u){m(i(u))});i(".quadmenu-column",r).each(function(t,u){m(i(u));j(i(u))});i(".quadmenu-column-item",r).each(function(t,u){m(i(u))});i(".quadmenu-widget",r).each(function(t,u){l(i(u))});i(".submit-add-to-quadmenu-column, .submit-add-to-quadmenu-tab, .submit-add-to-quadmenu-panel",s).each(function(t,u){h(i(u))})};var k=function(t,u,r){var s=i(t),q=i(u);if(!q.length){return false}i.ajax({type:"post",url:ajaxurl,data:{action:"quadmenu_add_nav_menu_item",nonce:quadmenu.nonce,menu_id:i("#menu").val(),"menu-item":r},beforeSend:function(){s.addClass("is-active")},complete:function(){s.removeClass("is-active")},success:function(w){if(w.success!==true){alert(w.data);return}var v=i("<ul>"+w.data+"</ul>");i(".quadmenu-tab, .quadmenu-panel, .quadmenu-column, .quadmenu-column-item",v).each(function(){m(i(this));c(i(this));f(i(this));e(i(this));if(i(this).hasClass("quadmenu-widget")){l(i(this))}if(i(this).hasClass("quadmenu-column")){j(i(this))}});i(".submit-add-to-quadmenu-column, .submit-add-to-quadmenu-tab, .submit-add-to-quadmenu-panel",v).each(function(){h(i(this))});q.append(v.contents()).trigger("add.quadmenu.item",[q])},})};i(document).on("click.quadmenu.submit",".submit-add-to-quadmenu, .submit-add-to-quadmenu-column-inside",function(v){v.preventDefault();var z=i(this),r={},A=i("#"+v.target.id.replace(/submit-/,"")),u=z.parent().find(".spinner"),s=A.find(".tabs-panel-active .categorychecklist li input:checked");var x=z.data("menu_item_parent_id")||false,w=x?i("#quadmenu-column-items-"+x):i("#menu-to-edit");if(!w.length){return false}if(v.target.id&&"submit-customlinkdiv"==v.target.id){var q=i("#custom-menu-item-url").val(),y=i("#custom-menu-item-name").val();if(""===q||"http://"==q){i("#customlinkdiv").addClass("form-invalid");return false}r[-1]={"menu-item-status":"publish","menu-item-type":"custom","menu-item-url":q,"menu-item-title":y,"menu-item-parent-id":x,}}else{if(v.target.id&&-1!=v.target.id.indexOf("submit-")&&s.length){s.each(function(){var C=i(this),D=/menu-item\[([^\]]*)/,B=D.exec(C.attr("name")),E="undefined"==typeof B[1]?0:parseInt(B[1],10);r[E]=C.closest("li").quadmenuItemData("add-menu-item",E);r[E]["menu-item-status"]="publish";r[E]["menu-item-parent-id"]=x})}else{return false}}k(u,w,r)});i(document).on("click",function(q){if(!i(q.target).is(".add-quadmenu-column-item")&&!i(q.target).is(".submit-add-to-quadmenu-column-inside")&&!i(q.target).closest("#menu-settings-column").length){i(".add-quadmenu-column-item").removeClass("selected");i("#menu-settings-column li").removeClass("current-column");i("#quadmenu_custom_nav_widgets").removeClass("active").removeClass("open")}});i(document).on("click.quadmenu.dropdown",".dropdown",function(q){i(this).addClass("open");i(".dropdown").not(i(this)).removeClass("open")});i(document).on("shown.quadmenu.modal","#modal_icons",function(t){c(i(this));var s=i(this),r=s.find(".save"),q=i(t.relatedTarget);s.data("target",q.attr("id"));r.on("click",function(y){y.preventDefault();var x=i(".menu-item-icon",s).val();if(!s.data("target")){return}var u=i("input#"+s.data("target")),w=u.closest(".redux-field"),v=w.find("h3"),z=v.find("i");u.val(x);if(z.length){z.remove()}v.prepend('<i class="'+x+'"></i>');s.modal("hide")})});i(document).on("add.quadmenu.item",function(r,q){q.find(".open").not(":last").removeClass("open")});i(document).on("remove.quadmenu.item",function(t,s){t.preventDefault();t.stopPropagation();if(!s.hasClass("quadmenu-panel")&&!s.hasClass("quadmenu-tab")){return}var r=s.closest(".dropdown"),q=s.closest(".quadmenu-tabs");if(!r.length){return}r.fadeOut().remove();setTimeout(function(){q.find(".dropdown").removeClass("open").first().addClass("open")},200)});i(document).on("save.quadmenu.settings",".quadmenu-tab-pane-default",function(r,s,q){i(q).each(function(t,u){i("#edit-"+u.name+"-"+s).val(u.value).trigger("change")})});i(document).on("click.quadmenu.close",".quadmenu_close",function(s){var r=i("#menu-management"),q=i("#quadmenu-settings");q.remove();r.removeClass("open")});i(document).on("click.quadmenu.open",".quadmenu_open",function(v){v.preventDefault();var w=i(this).closest("li"),u=i(this).parent().find(".spinner"),s=w.find(".menu-item-settings input.menu-item-data-db-id").val(),r=parseInt(w.prop("class").match(/menu-item-depth-([0-9]+)/)[1]);var t=i("#menu-management"),q=i("#post-body",t);if(o&&o.readyState!=4){o.abort()}if(w.data("openning")){return false}o=i.ajax({type:"post",url:ajaxurl,data:{menu_id:i("#menu").val(),menu_item_id:s,menu_item_depth:r,action:"quadmenu_add_nav_menu_item_settings",nonce:quadmenu.nonce,},beforeSend:function(){u.addClass("is-active");w.addClass("opening").data("openning",true)},complete:function(){u.removeClass("is-active");w.removeClass("openning").removeData("openning")},success:function(x){if(x.success!==true){alert(x.data);return}t.addClass("open");q.prepend(x.data);n(q);e(q);p(q);c(q);a(q);d(q);g(q);f(q);i("html,body").animate({scrollTop:i("#nav-menu-header").offset().top},"slow")}})});i(document).on("click","ul.redux-group-menu > li",function(t){t.preventDefault();var s=i(this);if(!s.hasClass("active")){return}var q=s.attr("class").match(/quadmenu_theme_[\w-]*\b/);if(q){var r=q.toString().replace("quadmenu_theme_","");i("#quadmenu_duplicate_theme").data("theme",r).fadeIn();i("#quadmenu_delete_theme").data("theme",r).fadeIn();return}i("#quadmenu_duplicate_theme").fadeOut();i("#quadmenu_delete_theme").fadeOut()});i(document).on("click","#quadmenu_add_theme ,#quadmenu_delete_theme",function(t){t.preventDefault();var s=i(this),r=i(this).parent().parent().find(".spinner"),q=s.data("theme");i.ajax({type:"post",url:ajaxurl,data:{action:s.attr("id"),nonce:quadmenu.nonce,current_theme:q,},beforeSend:function(){r.addClass("is-active")},complete:function(){r.removeClass("is-active")},success:function(u){if(u.success!==true){alert(u.data);return}window.location.href=u.data}})});i(document).on("click.quadmenu.import",".quadmenu_import",function(t){t.preventDefault();var s=i(this),r=s.closest(".theme"),q=r.find(".spinner");if(r.data("importing")){return false}if(!r.data("plugin")){return false}i.ajax({type:"post",url:ajaxurl,data:{plugin:r.data("plugin"),action:"quadmenu_compatibility_import",nonce:quadmenu.nonce,},beforeSend:function(){q.addClass("is-active");r.addClass("importing").data("importing",true)},complete:function(){q.removeClass("is-active");r.removeClass("importing").removeData("importing")},success:function(u){if(u.success!==true){alert(u.data);return}window.location.href=u.data}})});i(document).on("ready",function(q){if(i("#last_tab").val()!==""){i("ul.redux-group-menu > li."+i("#last_tab").val()+" > a").click();return}})})(jQuery);